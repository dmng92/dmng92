// ... (rest of your unchanged HTML head)
<script>
  const galeria = document.getElementById('galeria');
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img');
  const lightboxLink = document.getElementById('lightbox-link');
  const porCarga = 120;
  let indexActual = 0;
  let imagenActualIndex = 0;
  let msnry;
  let scrollPos = 0; // <-- Nueva variable para guardar el scroll

  function cargarImagenes() {
    const fragment = document.createDocumentFragment();
    const fin = Math.min(indexActual + porCarga, imagenes.length);
    for (let i = indexActual; i < fin; i++) {
      const div = document.createElement('div');
      div.className = 'grid-item';
      const img = document.createElement('img');
      img.src = `imagenes/${imagenes[i]}`;
      img.loading = 'lazy';
      img.alt = imagenes[i];
      img.addEventListener('click', () => mostrarLightbox(img.src, i));
      div.appendChild(img);
      fragment.appendChild(div);
    }
    galeria.appendChild(fragment);

    imagesLoaded(galeria, function () {
      if (!msnry) {
        msnry = new Masonry(galeria, {
          itemSelector: '.grid-item',
          columnWidth: '.grid-sizer',
          percentPosition: true
        });
      } else {
        msnry.appended(Array.from(fragment.children));
      }
    });

    indexActual = fin;
  }

  window.addEventListener('scroll', () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
      cargarImagenes();
    }
  });

  function mostrarLightbox(src, index) {
    scrollPos = window.scrollY; // Guarda la posición actual del scroll
    lightboxImg.src = src;
    lightboxLink.href = src;
    imagenActualIndex = index;
    lightbox.classList.add('show');
    document.body.classList.add('no-scroll');
    document.body.style.top = `-${scrollPos}px`; // Corrige la posición
  }

  function cerrarLightbox() {
    lightbox.classList.remove('show');
    document.body.classList.remove('no-scroll');
    document.body.style.top = '';
    window.scrollTo(0, scrollPos); // Restaura scroll
  }

  document.addEventListener('keydown', (e) => {
    if (!lightbox.classList.contains('show')) return;
    if (e.key === 'ArrowRight') navegarLightbox(1);
    if (e.key === 'ArrowLeft') navegarLightbox(-1);
    if (e.key === 'Escape') cerrarLightbox();
  });

  function navegarLightbox(direccion) {
    imagenActualIndex += direccion;
    if (imagenActualIndex < 0) imagenActualIndex = 0;
    if (imagenActualIndex >= imagenes.length) imagenActualIndex = imagenes.length - 1;
    const nuevaSrc = `imagenes/${imagenes[imagenActualIndex]}`;
    lightboxImg.src = nuevaSrc;
    lightboxLink.href = nuevaSrc;
  }

  cargarImagenes();
</script>
